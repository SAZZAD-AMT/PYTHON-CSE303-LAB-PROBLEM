/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

var Fn=Object.create;var U=Object.defineProperty,Wn=Object.defineProperties,zn=Object.getOwnPropertyDescriptor,Kn=Object.getOwnPropertyDescriptors,Yn=Object.getOwnPropertyNames,Pe=Object.getOwnPropertySymbols,Qn=Object.getPrototypeOf,Oe=Object.prototype.hasOwnProperty,Vn=Object.prototype.propertyIsEnumerable;var Be=(r,e,t)=>e in r?U(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E=(r,e)=>{for(var t in e||(e={}))Oe.call(e,t)&&Be(r,t,e[t]);if(Pe)for(var t of Pe(e))Vn.call(e,t)&&Be(r,t,e[t]);return r},Te=(r,e)=>Wn(r,Kn(e)),Ae=r=>U(r,"__esModule",{value:!0});var a=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Xn=(r,e)=>{Ae(r);for(var t in e)U(r,t,{get:e[t],enumerable:!0})},Zn=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Yn(e))!Oe.call(r,n)&&n!=="default"&&U(r,n,{get:()=>e[n],enumerable:!(t=zn(e,n))||t.enumerable});return r},k=r=>Zn(Ae(U(r!=null?Fn(Qn(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var se=a((Ni,Ce)=>{Ce.exports=function(e,t,n){e(t),n&&n(t===!0?null:t)}});var z=a((Ri,Ne)=>{"use strict";var Ie=se();Ne.exports=function(e,t){if(!e)return function(u,i){return u?Ie(i,u,t):i(!0)};Array.isArray(e)||(e=Object.keys(e).map(function(u){return e[u]}));var n=0;return function(u,i){if(u)return Ie(i,u,t);n>=e.length?i(!0):i(null,e[n++])}}});var Le=a((Li,Re)=>{"use strict";var jn=z();Re.exports=function(r){return jn(Object.keys(r))}});var fe=a((Di,De)=>{"use strict";var bn=se();De.exports=function(e,t){return function(n,u){if(n)return bn(u,n,t);if(e!=null){var i=e;e=null,u(null,i)}else u(!0)}}});var Ue=a((Ji,Je)=>{"use strict";Je.exports=function(e){var t=0;return e=e||1/0,function(n,u){if(n)return u&&u(n);if(t>e)return u(!0);u(null,t++)}}});var Me=a((Ui,$e)=>{"use strict";$e.exports=function(e){return e=e||Math.random,function(t,n){return t?n&&n(t):n(null,e())}}});var He=a(($i,Ge)=>{"use strict";Ge.exports=function(){return function(e,t){t(!0)}}});var We=a((Mi,Fe)=>{"use strict";Fe.exports=function(e){return function(t,n){n(e)}}});var Ke=a((Gi,ze)=>{"use strict";ze.exports={keys:Le(),once:fe(),values:z(),count:Ue(),infinite:Me(),empty:He(),error:We()}});var A=a((Hi,Ye)=>{"use strict";Ye.exports=function(e,t){var n,u;function i(s){if(n=s,u)return i.abort();(function f(){for(var o=!0,l=!1;o;)if(l=!1,n(null,function(c,p){if(l=!0,c=c||u){if(o=!1,t)t(c===!0?null:c);else if(c&&c!==!0)throw c}else e&&e(p)===!1||u?(o=!1,n(u||!0,t||function(){})):o||f()}),!l){o=!1;return}})()}return i.abort=function(s,f){if(typeof s=="function"&&(f=s,s=!0),u=s||!0,n)return n(u,f||function(){})},i}});var Ve=a((Fi,Qe)=>{"use strict";var eu=A();Qe.exports=function(e){return eu(null,e)}});var Ze=a((Wi,Xe)=>{"use strict";var ru=A();Xe.exports=function(e){return ru(function(t){console.log(t)},e)}});var C=a((zi,je)=>{je.exports=function(e){return e&&(typeof e=="string"?function(t){return t[e]}:typeof e=="object"&&typeof e.exec=="function"?function(t){var n=e.exec(t);return n&&n[0]}:e)}});var rr=a((Ki,er)=>{"use strict";function be(r){return r}var tu=C(),nu=A();er.exports=function(e,t){var n=!1;return t?e=tu(e)||be:(t=e,e=be),nu(function(u){if(e(u))return n=!0,t(null,u),!1},function(u){n||t(u===!0?null:u,null)})}});var K=a((Yi,tr)=>{"use strict";var uu=A();tr.exports=function(e,t,n){n||(n=t,t=null);var u=uu(function(i){t=e(t,i)},function(i){n(i,t)});return arguments.length===2?function(i){i(null,function(s,f){if(s)return n(s===!0?null:s);t=f,u(i)})}:u}});var ur=a((Qi,nr)=>{"use strict";var iu=K();nr.exports=function(e){return iu(function(t,n){return t.push(n),t},[],e)}});var or=a((Vi,ir)=>{"use strict";var ou=K();ir.exports=function(e){return ou(function(t,n){return t+n},"",e)}});var fr=a((Xi,sr)=>{"use strict";sr.exports={drain:A(),onEnd:Ve(),log:Ze(),find:rr(),reduce:K(),collect:ur(),concat:or()}});var cr=a((Zi,lr)=>{"use strict";function su(r){return r}var fu=C();lr.exports=function(e){return e?(e=fu(e),function(t){return function(n,u){t(n,function(i,s){try{s=i?null:e(s)}catch(f){return t(f,function(){return u(f)})}u(i,s)})}}):su}});var pr=a((ji,ar)=>{"use strict";function lu(r){return r}var cu=C();ar.exports=function(e){if(!e)return lu;e=cu(e);var t=!1,n,u;return function(i){return function s(f,o){if(u)return o(u);f?(u=f,t?i(f,function(l){t?n=o:o(f)}):i(f,function(l){o(f)})):i(null,function(l,c){l?o(l):u?o(u):(t=!0,e(c,function(p,d){t=!1,u?(o(u),n&&n(u)):p?s(p,o):o(null,d)}))})}}}});var le=a((bi,dr)=>{var au=C();function pu(r){return r}dr.exports=function(e){return typeof e=="object"&&typeof e.test=="function"?function(t){return e.test(t)}:au(e)||pu}});var Y=a((eo,hr)=>{"use strict";var du=le();hr.exports=function(e){return e=du(e),function(t){return function n(u,i){for(var s,f=!0;f;)f=!1,s=!0,t(u,function(o,l){if(!o&&!e(l))return s?f=!0:n(o,i);i(o,l)}),s=!1}}}});var yr=a((ro,vr)=>{"use strict";var hu=le(),vu=Y();vr.exports=function(e){return e=hu(e),vu(function(t){return!e(t)})}});var xr=a((to,qr)=>{"use strict";qr.exports=function(e,t){var n=!1;function u(i){n||!t||(n=!0,t(i===!0?null:i))}return function(i){return function(s,f){return s&&u(s),i(s,function(o,l){o?u(o):e&&e(l),f(o,l)})}}}});var wr=a((no,gr)=>{"use strict";gr.exports=function(e,t){t=t||{};var n=t.last||!1,u=!1;if(typeof e=="number"){n=!0;var i=e;e=function(){return--i}}return function(s){function f(o){s(!0,function(l){n=!1,o(l||!0)})}return function(o,l){u&&!o?n?f(l):l(u):(u=o)?s(u,l):s(null,function(c,p){(u=u||c)?l(u):e(p)?l(null,p):(u=!0,n?l(null,p):f(l))})}}}});var ce=a((uo,mr)=>{"use strict";function yu(r){return r}var qu=C(),xu=Y();mr.exports=function(e,t){e=qu(e)||yu;var n={};return xu(function(u){var i=e(u);return n[i]?!!t:(n[i]=!0,!t)})}});var _r=a((io,Er)=>{"use strict";var gu=ce();Er.exports=function(e){return gu(e,!0)}});var Sr=a((oo,kr)=>{"use strict";var wu=z(),mu=fe();kr.exports=function(){return function(e){var t;return function(n,u){n?t?t(n,function(f){e(f||n,u)}):e(n,u):t?i():s();function i(){t(null,function(f,o){f===!0?s():f?e(!0,function(l){u(f)}):u(null,o)})}function s(){t=null,e(null,function(f,o){if(f)return u(f);Array.isArray(o)||o&&typeof o=="object"?o=wu(o):typeof o!="function"&&(o=mu(o)),t=o,i()})}}}}});var Or=a((so,Pr)=>{"use strict";Pr.exports={map:cr(),asyncMap:pr(),filter:Y(),filterNot:yr(),through:xr(),take:wr(),unique:ce(),nonUnique:_r(),flatten:Sr()}});var ae=a((fo,Br)=>{"use strict";Br.exports=function r(e){var t=arguments.length;if(typeof e=="function"&&e.length===1){for(var n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];return function(f){if(n==null)throw new TypeError("partial sink should only be called once!");var o=n;switch(n=null,t){case 1:return r(f,o[0]);case 2:return r(f,o[0],o[1]);case 3:return r(f,o[0],o[1],o[2]);case 4:return r(f,o[0],o[1],o[2],o[3]);default:return o.unshift(f),r.apply(null,o)}}}var i=e;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<t;u++){var s=arguments[u];typeof s=="function"?i=s(i):s&&typeof s=="object"&&(s.sink(i),i=s.source)}return i}});var Q=a((S,Ir)=>{"use strict";var Tr=Ke(),Ar=fr(),Cr=Or();S=Ir.exports=ae();S.pull=S;for(q in Tr)S[q]=Tr[q];var q;for(q in Cr)S[q]=Cr[q];var q;for(q in Ar)S[q]=Ar[q];var q});var pe=a((co,Nr)=>{var lo=Nr.exports=function(r){(function e(){var t=!0,n=!1,u=!1;do u=!0,t=!1,r.call(this,function(){u?t=!0:e()}),u=!1;while(t)})()}});var Lr=a((ao,Rr)=>{var Eu=pe();Rr.exports=function(r,e){return function(t){var n=[],u,i;function s(l){n.push(l)}r=r||function(l){this.queue(l)},e=e||function(){this.queue(null)};var f={emit:function(l,c){l=="data"&&s(c),l=="end"&&(u=!0,s(null)),l=="error"&&(i=c)},queue:s},o;return function(l,c){if(u=u||l,l)return t(l,function(){if(o){var p=o;o=null,p(l)}c(l)});o=c,Eu(function p(d){if(!!o)if(c=o,i)o=null,c(i);else if(n.length){var h=n.shift();o=null,c(h===null,h)}else t(u,function(v,w){if(v&&v!==!0)return i=v,d();if(u=u||v)e.call(f);else if(w!==null&&(r.call(f,w),i||u))return t(i||u,function(){o=null,c(i||u)});d(p)})})}}}});var Jr=a((po,Dr)=>{Dr.exports=function(){var r=[],e=0;function t(){return r.reduce(function(n,u){return n+u.length},0)}return{length:e,data:this,add:function(n){if(!Buffer.isBuffer(n))throw new Error("data must be a buffer, was: "+JSON.stringify(n));return this.length=e=e+n.length,r.push(n),this},has:function(n){return n==null?e>0:e>=n},get:function(n){var u;if(n==null||n===e){e=0;var i=r;return r=[],i.length==1?i[0]:Buffer.concat(i)}else if(r.length>1&&n<=(u=r[0].length)){var s=r[0].slice(0,n);return n===u?r.shift():r[0]=r[0].slice(n,u),e-=n,s}else if(n<e){for(var f=[],o=0;o+r[0].length<n;){var l=r.shift();o+=l.length,f.push(l)}return o<n&&(f.push(r[0].slice(0,n-o)),r[0]=r[0].slice(n-o,r[0].length),this.length=e=e-n),Buffer.concat(f)}else throw new Error("could not get "+n+" bytes")}}}});var Gr=a((ho,Mr)=>{"use strict";var _u=Jr();function ku(r){return Number.isFinite(r)}function Ur(r){return typeof r=="function"}function $r(r,e){return e?function(t,n){var u=setTimeout(function(){r(new Error("pull-reader: read exceeded timeout"),n)},e);r(t,function(i,s){clearTimeout(u),n(i,s)})}:r}Mr.exports=function(r){var e=[],t,n,u=!1,i=_u(),s,f,o;function l(){for(;e.length;)if(e[0].length==null&&i.has(1))e.shift().cb(null,i.get());else if(i.has(e[0].length)){var d=e.shift();d.cb(null,i.get(d.length))}else if(s==!0&&e[0].length&&i.length<e[0].length){var h="stream ended with:"+i.length+" but wanted:"+e[0].length;e.shift().cb(new Error(h))}else if(s)e.shift().cb(s);else return!!e.length;return e.length||!i.has(1)||o}function c(){var d=l();d&&!u&&t&&!u&&!f&&(u=!0,n(null,function(h,v){if(u=!1,h)return s=h,l();i.add(v),c()}))}function p(d){if(o){for(;e.length;)e.shift().cb(o);return cb&&cb(o)}n=$r(d,r),t=d,c()}return p.abort=function(d,h){o=d||!0,t?(u=!0,t(o,function(){for(;e.length;)e.shift().cb(o);h&&h(o)})):h()},p.read=function(d,h,v){if(Ur(h)&&(v=h,h=r),Ur(v))e.push({length:ku(d)?d:null,cb:v}),c();else return f=!0,function(w,J){if(u||i.has(1)){if(w)return t(w,J);e.push({length:null,cb:J}),c()}else $r(t,h)(w,function(oe,Hn){J(oe,Hn)})}},p}});var br=a((P,jr)=>{var Su=Lr(),Pu=Gr(),Hr=0,Fr=1,Wr=2,zr="GOODBYE",Ou=Buffer.isBuffer;function Kr(r){return typeof r=="string"}function Yr(r){var e=Buffer.alloc(9),t=0,n=r.value!==void 0?r.value:r.end;return Kr(r)&&r===zr?(e.fill(0),[e,null]):(Kr(n)?(t=Fr,n=Buffer.from(n,"utf-8")):Ou(n)?t=Hr:(t=Wr,n=Buffer.from(JSON.stringify(n),"utf-8")),t=r.stream<<3|r.end<<2|t,e[0]=t,e.writeUInt32BE(n.length,1),e.writeInt32BE(r.req||0,5),[e,n])}function Qr(r){if(r.length!=9)throw new Error("expected header to be 9 bytes long");var e=r[0],t=r.readUInt32BE(1),n=r.readInt32BE(5);return{req:n,stream:!!(e&8),end:!!(e&4),value:null,length:t,type:e&3}}function Vr(r,e){if(r.length!==e.length)throw new Error("incorrect length, expected:"+e.length+" found:"+r.length);if(Hr===e.type)e.value=r;else if(Fr===e.type)e.value=r.toString();else if(Wr===e.type)e.value=JSON.parse(r.toString());else throw new Error("unknown message type");return e}function Xr(){return Su(function(r){var e=Yr(r);this.queue(e[0]),e[1]!==null&&this.queue(e[1])})}function Zr(){var r=Pu(),e=!1;return function(t){return r(t),function(n,u){if(e)return u(!0);if(n)return r.abort(n,u);r.read(9,function(i,s){if(i)return u(i);var f=Qr(s);if(f.length===0)return e=!0,u(null,zr);r.read(f.length,function(o,l){if(o)return u(o);try{Vr(l,f)}catch(c){return u(c)}u(null,f)})})}}}P=jr.exports=function(r){return{source:Xr()(r.source),sink:function(e){return r.sink(Zr()(e))}}};P.encodePair=Yr;P.decodeHead=Qr;P.decodeBody=Vr;P.encode=Xr;P.decode=Zr});var tt=a((vo,rt)=>{function $(r){return r&&(r===!0?!0:{message:r.message,name:r.name,stack:r.stack})}rt.exports=function(r){return new y(r)};function y(r){this.ended=!1,this.opts=r,this._req_counter=1,this._requests={},this._instreams={},this._outstreams={},this._closecbs=[],this._closing=!1,this._closed=!1,r.close&&this._closecbs.push(r.close)}y.prototype.message=function(r){this.read({req:0,stream:!1,end:!1,value:r})};y.prototype.request=function(r,e){if(this._closing)return e(new Error("parent stream is closing"));var t=this._req_counter++,n=this;this._requests[t]=function(u,i){delete n._requests[t],e(u,i),n._maybedone(u)},this.read({req:t,stream:!1,end:!1,value:r})};y.prototype.stream=function(){if(this._closing)throw new Error("parent stream is closing");var r=this._req_counter++,e=this;return this._outstreams[r]=new M(r,this,function(){delete e._outstreams[r]}),this._outstreams[r]};y.prototype.close=function(r){if(!r)throw new Error("packet-stream.close *must* have callback");if(this._closed)return r();this._closecbs.push(r),this._closing=!0,this._maybedone()};y.prototype.destroy=function(r){r=r||$(r),this.ended=r,this._closing=!0;var e=r===!0?new Error("unexpected end of parent stream"):r,t=0;for(var n in this._requests)t++,this._requests[n](e);for(var n in this._instreams)t++,this._instreams[n].writeEnd=!0,this._instreams[n].destroy(e);for(var n in this._outstreams)t++,this._outstreams[n].writeEnd=!0,this._outstreams[n].destroy(e);t===0&&r===!0&&(e=null),this._maybedone(e)};y.prototype._maybedone=function(r){this._closed||!this._closing||Object.keys(this._requests).length!==0||Object.keys(this._instreams).length!==0||Object.keys(this._outstreams).length!==0||(this._closed=!0,this._closecbs.forEach(function(e){e(r)}),this.read(null,r||!0),this.opts=null,this._closecbs.length=0,this.read=et)};function et(r){console.error("packet-stream asked to read after closed",r)}y.prototype.read=function(r){console.error("please overwrite read method to do IO",r)};y.prototype.write=function(r,e){this.ended||(e?this.destroy(e):r.req&&!r.stream?this._onrequest(r):r.req&&r.stream?this._onstream(r):this._onmessage(r))};y.prototype._onmessage=function(r){this.opts&&typeof this.opts.message=="function"&&this.opts.message(r.value)};y.prototype._onrequest=function(r){var e=r.req*-1;if(r.req<0)typeof this._requests[e]=="function"&&this._requests[e](r.end?r.value:null,r.end?null:r.value);else if(this.opts&&typeof this.opts.request=="function"){var t=!1,n=this;this.opts.request(r.value,function(i,s){if(t)throw new Error("cb called twice from local api");t=!0,i?n.read({value:$(i),end:!0,req:e}):n.read({value:s,end:!1,req:e}),n._maybedone()})}else{if(this.ended){var u=this.ended===!0?new Error("unexpected end of parent stream"):this.ended;this.read({value:$(u),end:!0,stream:!1,req:e})}else this.read({value:{message:"Unable to handle requests",name:"NO_REQUEST_HANDLER",stack:null},end:!0,stream:!1,req:e});this._maybedone()}};y.prototype._onstream=function(r){if(r.req<0){var e=r.req*-1,t=this._outstreams[e];if(!t)return console.error("no stream for incoming msg",r);r.end?(t.writeEnd&&delete this._outstreams[e],t.readEnd=!0,t.read(null,r.value),this._maybedone()):t.read(r.value)}else{var e=r.req,n=this._instreams[e];if(!n){var u=this;n=this._instreams[e]=new M(e*-1,this,function(){delete u._instreams[e]}),this.opts&&typeof this.opts.stream=="function"&&this.opts.stream(n)}r.end?(n.writeEnd&&delete this._instreams[e],n.readEnd=!0,n.read&&n.read(null,r.value),this._maybedone()):n.read?n.read(r.value):console.error("no .read for stream:",n.id,"dropped:",r)}};function M(r,e,t){this.id=r,this.read=null,this.writeEnd=null,this.readEnd=null,this._ps=e,this._remove=t,this._seq_counter=1}M.prototype.write=function(r,e){if(e){this.writeEnd=e;var t=this._ps;t&&(t.read({req:this.id,stream:!0,end:!0,value:$(e)}),this.readEnd&&this.destroy(e),t._maybedone(e))}else this._ps&&this._ps.read({req:this.id,stream:!0,end:!1,value:r})};M.prototype.end=function(r){this.write(null,$(r||!0))};M.prototype.destroy=function(r){if(this.writeEnd){if(!this.readEnd){this.readEnd=!0;try{this.read&&this.read(null,r)}catch(e){console.error("Exception thrown by PacketStream substream end handler",e),console.error(e.stack)}}}else{if(this.writeEnd=!0,!this.readEnd){this.readEnd=!0;try{this.read(null,r)}catch(e){console.error("Exception thrown by PacketStream substream end handler",e),console.error(e.stack)}}this.write(null,r)}this._ps&&(this._remove(),this._remove=null,this.read=et,this._ps=null)}});var ut=a((yo,G)=>{"use strict";var Bu=Q();function Tu(r){let e=!1;return(t,n)=>{e||(e=!0,r(t,n))}}function de(r,e){let t=[],n=!1,u=!1,i,s,f=Tu((o,l)=>{e&&e(o,l),r=null,e=null,i=null,s&&s(o||!0,()=>{})});return r.read=function(o,l){if(n=n||l,i){let c=i;i=null,c(n,o)}else!n&&!u&&t.push(o);n&&f(n!==!0?n:null)},{source(o,l){o?(r&&r.write(null,o),l(o),t.length=0,u=!0,f(o!==!0?o:null)):t.length?l(null,t.shift()):n?l(n):i=l},sink(o){if(n)return s=null,o(n,()=>{});s=o,Bu.drain(l=>{if(n)return!1;r.write(l)},l=>{r&&!r.writeEnd&&r.write(null,l||!0),f&&f(l)})(o)}}}function nt(r,e){return de(r,t=>{r.writeEnd||r.write(null,t||!0),e&&e(t)})}function Au(r){return nt(r).source}function Cu(r,e){return nt(r,e).sink}G.exports=de;G.exports.source=Au;G.exports.sink=Cu;G.exports.duplex=de});var ot=a((qo,it)=>{it.exports=function(e){var t,n,u;function i(s){return function(f,o){s(f,function(l,c){if(l&&!u)return u=!0,o(null,e);l&&t?o(l):l?n=o:o(null,c)})}}return i.end=function(){return t=!0,n&&n(t),i},i}});var he=a((xo,st)=>{st.exports=function(e,t,n){e(t),n&&n(t===!0?null:t)}});var V=a((go,lt)=>{"use strict";var ft=he();lt.exports=function(e,t){if(!e)return function(u,i){return u?ft(i,u,t):i(!0)};Array.isArray(e)||(e=Object.keys(e).map(function(u){return e[u]}));var n=0;return function(u,i){if(u)return ft(i,u,t);n>=e.length?i(!0):i(null,e[n++])}}});var at=a((wo,ct)=>{"use strict";var Iu=V();ct.exports=function(r){return Iu(Object.keys(r))}});var ve=a((mo,pt)=>{"use strict";var Nu=he();pt.exports=function(e,t){return function(n,u){if(n)return Nu(u,n,t);if(e!=null){var i=e;e=null,u(null,i)}else u(!0)}}});var ht=a((Eo,dt)=>{"use strict";dt.exports=function(e){var t=0;return e=e||1/0,function(n,u){if(n)return u&&u(n);if(t>e)return u(!0);u(null,t++)}}});var yt=a((_o,vt)=>{"use strict";vt.exports=function(e){return e=e||Math.random,function(t,n){return t?n&&n(t):n(null,e())}}});var xt=a((ko,qt)=>{"use strict";qt.exports=function(){return function(e,t){t(!0)}}});var wt=a((So,gt)=>{"use strict";gt.exports=function(e){return function(t,n){n(e)}}});var Et=a((Po,mt)=>{"use strict";mt.exports={keys:at(),once:ve(),values:V(),count:ht(),infinite:yt(),empty:xt(),error:wt()}});var I=a((Oo,_t)=>{"use strict";_t.exports=function(e,t){var n,u;function i(s){if(n=s,u)return i.abort();(function f(){for(var o=!0,l=!1;o;)if(l=!1,n(null,function(c,p){if(l=!0,c=c||u){if(o=!1,t)t(c===!0?null:c);else if(c&&c!==!0)throw c}else e&&e(p)===!1||u?(o=!1,n(u||!0,t||function(){})):o||f()}),!l){o=!1;return}})()}return i.abort=function(s,f){if(typeof s=="function"&&(f=s,s=!0),u=s||!0,n)return n(u,f||function(){})},i}});var St=a((Bo,kt)=>{"use strict";var Ru=I();kt.exports=function(e){return Ru(null,e)}});var Ot=a((To,Pt)=>{"use strict";var Lu=I();Pt.exports=function(e){return Lu(function(t){console.log(t)},e)}});var N=a((Ao,Bt)=>{Bt.exports=function(e){return e&&(typeof e=="string"?function(t){return t[e]}:typeof e=="object"&&typeof e.exec=="function"?function(t){var n=e.exec(t);return n&&n[0]}:e)}});var Ct=a((Co,At)=>{"use strict";function Tt(r){return r}var Du=N(),Ju=I();At.exports=function(e,t){var n=!1;return t?e=Du(e)||Tt:(t=e,e=Tt),Ju(function(u){if(e(u))return n=!0,t(null,u),!1},function(u){n||t(u===!0?null:u,null)})}});var X=a((Io,It)=>{"use strict";var Uu=I();It.exports=function(e,t,n){n||(n=t,t=null);var u=Uu(function(i){t=e(t,i)},function(i){n(i,t)});return arguments.length===2?function(i){i(null,function(s,f){if(s)return n(s===!0?null:s);t=f,u(i)})}:u}});var Rt=a((No,Nt)=>{"use strict";var $u=X();Nt.exports=function(e){return $u(function(t,n){return t.push(n),t},[],e)}});var Dt=a((Ro,Lt)=>{"use strict";var Mu=X();Lt.exports=function(e){return Mu(function(t,n){return t+n},"",e)}});var Ut=a((Lo,Jt)=>{"use strict";Jt.exports={drain:I(),onEnd:St(),log:Ot(),find:Ct(),reduce:X(),collect:Rt(),concat:Dt()}});var Mt=a((Do,$t)=>{"use strict";function Gu(r){return r}var Hu=N();$t.exports=function(e){return e?(e=Hu(e),function(t){return function(n,u){t(n,function(i,s){try{s=i?null:e(s)}catch(f){return t(f,function(){return u(f)})}u(i,s)})}}):Gu}});var Ht=a((Jo,Gt)=>{"use strict";function Fu(r){return r}var Wu=N();Gt.exports=function(e){if(!e)return Fu;e=Wu(e);var t=!1,n,u;return function(i){return function s(f,o){if(u)return o(u);f?(u=f,t?i(f,function(){t?n=o:o(f)}):i(f,o)):i(null,function(l,c){l?o(l):u?o(u):(t=!0,e(c,function(p,d){t=!1,u?(o(u),n(u)):p?s(p,o):o(null,d)}))})}}}});var ye=a((Uo,Ft)=>{var zu=N();function Ku(r){return r}Ft.exports=function(e){return typeof e=="object"&&typeof e.test=="function"?function(t){return e.test(t)}:zu(e)||Ku}});var Z=a(($o,Wt)=>{"use strict";var Yu=ye();Wt.exports=function(e){return e=Yu(e),function(t){return function n(u,i){for(var s,f=!0;f;)f=!1,s=!0,t(u,function(o,l){if(!o&&!e(l))return s?f=!0:n(o,i);i(o,l)}),s=!1}}}});var Kt=a((Mo,zt)=>{"use strict";var Qu=ye(),Vu=Z();zt.exports=function(e){return e=Qu(e),Vu(function(t){return!e(t)})}});var Qt=a((Go,Yt)=>{"use strict";Yt.exports=function(e,t){var n=!1;function u(i){n||!t||(n=!0,t(i===!0?null:i))}return function(i){return function(s,f){return s&&u(s),i(s,function(o,l){o?u(o):e&&e(l),f(o,l)})}}}});var Xt=a((Ho,Vt)=>{"use strict";Vt.exports=function(e,t){t=t||{};var n=t.last||!1,u=!1;if(typeof e=="number"){n=!0;var i=e;e=function(){return--i}}return function(s){function f(o){s(!0,function(l){n=!1,o(l||!0)})}return function(o,l){u?n?f(l):l(u):(u=o)?s(u,l):s(null,function(c,p){(u=u||c)?l(u):e(p)?l(null,p):(u=!0,n?l(null,p):f(l))})}}}});var qe=a((Fo,Zt)=>{"use strict";function Xu(r){return r}var Zu=N(),ju=Z();Zt.exports=function(e,t){e=Zu(e)||Xu;var n={};return ju(function(u){var i=e(u);return n[i]?!!t:(n[i]=!0,!t)})}});var bt=a((Wo,jt)=>{"use strict";var bu=qe();jt.exports=function(e){return bu(e,!0)}});var rn=a((zo,en)=>{"use strict";var ei=V(),ri=ve();en.exports=function(){return function(e){var t;return function(n,u){n?t?t(n,function(f){e(f||n,u)}):e(n,u):t?i():s();function i(){t(null,function(f,o){f===!0?s():f?e(!0,function(l){u(f)}):u(null,o)})}function s(){t=null,e(null,function(f,o){if(f)return u(f);Array.isArray(o)||o&&typeof o=="object"?o=ei(o):typeof o!="function"&&(o=ri(o)),t=o,i()})}}}}});var nn=a((Ko,tn)=>{"use strict";tn.exports={map:Mt(),asyncMap:Ht(),filter:Z(),filterNot:Kt(),through:Qt(),take:Xt(),unique:qe(),nonUnique:bt(),flatten:rn()}});var on=a((Yo,un)=>{"use strict";un.exports=function r(e){var t=arguments.length;if(typeof e=="function"&&e.length===1){for(var n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];return function(f){if(n==null)throw new TypeError("partial sink should only be called once!");var o=n;switch(n=null,t){case 1:return r(f,o[0]);case 2:return r(f,o[0],o[1]);case 3:return r(f,o[0],o[1],o[2]);case 4:return r(f,o[0],o[1],o[2],o[3]);default:return o.unshift(f),r.apply(null,o)}}}var i=e;i&&typeof i.source=="function"&&(i=i.source);for(var u=1;u<t;u++){var s=arguments[u];typeof s=="function"?i=s(i):s&&typeof s=="object"&&(s.sink(i),i=s.source)}return i}});var an=a((H,cn)=>{"use strict";var sn=Et(),fn=Ut(),ln=nn();H=cn.exports=on();for(x in sn)H[x]=sn[x];var x;for(x in ln)H[x]=ln[x];var x;for(x in fn)H[x]=fn[x];var x});var dn=a((Qo,pn)=>{var ti=ot(),xe=an();pn.exports=function(r,e){e=e||"GOODBYE";var t=ti(e);return{source:xe(r.source,t),sink:xe(xe.filter(function(n){if(n!==e)return!0;t.end()}),r.sink)}}});var F=a(g=>{"use strict";var j=Q();function ni(r){return r?Object.keys(r).length===0:!0}g.set=function(e,t,n){let u,i;for(let s=0;s<t.length;s++){let f=t[s];e[f]=e[f]||{},u=e,i=f,e=e[f]}u[i]=n};g.get=function(e,t){if(typeof t=="string")return e[t];let n;for(let u=0;u<t.length;u++){let i=t[u];if(n=e=e[i],e==null)return e}return n};g.prefix=function(e,t){let n;for(let u=0;u<t.length;u++){let i=t[u];if(n=e=e[i],typeof e!="object")return e}return typeof n!="object"?!!n:!1};function ui(r,e){for(let t in e){let n=e[t];r[n]||(r[n]={}),r=r[n]}return r}function ii(r,e){(function t(n,u){let i=e[u];if(n)e.length-1===u?delete n[i]:u<e.length&&t(n[i],u+1);else return;ni(n[i])&&delete n[i]})(r,0)}function oi(r,e){for(let t in e)r[t]=e[t];return r}g.mount=function(e,t,n){if(!Array.isArray(t))throw new Error("path must be array of strings");return oi(ui(e,t),n)};g.unmount=function(e,t){return ii(e,t)};var b=r=>r==="source",ee=r=>r==="sink",hn=r=>r==="duplex",si=r=>r==="sync",fi=r=>r==="async",vn=r=>si(r)||fi(r),li=r=>b(r)||ee(r)||hn(r);g.isRequest=vn;g.isStream=li;function ge(r){return function(e){e(r||!0,()=>{})}}function yn(r){return{source:j.error(r),sink:ge(r)}}g.errorAsStream=function(e,t){return b(e)?j.error(t):ee(e)?ge(t):yn(t)};g.errorAsStreamOrCb=function(e,t,n){return vn(e)?n(t):b(e)?j.error(t):ee(e)?ge(t):n(t),yn(t)};g.pipeToStream=function(e,t,n){b(e)?t(n):ee(e)?n(t):hn(e)&&j(t,n,t)}});var we=a((Zo,xn)=>{function qn(r){if(r.stack&&r.name&&r.message)return r.stack.substring(r.name.length+3+r.message.length).split(`
`);if(r.stack)return r.stack.split(`
`)}function ci(r,e){return r.filter(function(t){return!~e.indexOf(t)})}var Xo=xn.exports=function(r,e){if(!(r.stack&&r.name&&r.message))return console.error(new Error("stackless error")),r;var t=new Error(e),n=ci(qn(t).slice(1),qn(r)).join(`
`);return t.__proto__=r,t.stack=t.name+": "+t.message+`
`+n+`
  `+r.stack,t}});var mn=a((jo,wn)=>{"use strict";var ai=tt(),me=ut(),pi=dn(),R=F(),gn=we();wn.exports=function(e,t,n){let u=ai({message(){},request(s,f){if(!Array.isArray(s.args))return f(new Error(`invalid request, args should be array, was: ${JSON.stringify(s)}`));let o=s.name,l=s.args,c=!1,p=!1;l.push((d,h)=>{p=!0,c=!0,f(d,h)});try{e("async",o,l)}catch(d){if(c||p)throw gn(d,"no callback provided to muxrpc async funtion");f(d)}},stream(s){s.read=function(o,l){if(l)return s.write(null,l);let{name:c,type:p,args:d}=o,h,v;if(s.read=null,!R.isStream(p))return s.write(null,new Error(`unsupported stream type: ${p}`));try{v=e(p,c,d)}catch(oe){h=oe}let J=me[p==="source"?"sink":p==="sink"?"source":"duplex"](s);return R.pipeToStream(p,J,h?R.errorAsStream(p,h):v)}},close(s){if(u=null,i.ended=!0,!i.closed&&(i.closed=!0,n)){let f=n;n=null,f(s)}}}),i=pi(me(u,()=>{}));return i=t?t(i):i,i.remoteCall=function(s,f,o,l){if(f==="emit")return u.message(o);if(!(R.isRequest(s)||R.isStream(s)))throw new Error(`unsupported type: ${JSON.stringify(s)}`);if(R.isRequest(s))return u.request({name:f,args:o},l);let c=u.stream(),p=me[s](c,l);return c.write({name:f,args:o,type:s}),p},i.isOpen=function(){return!u.ended},i.close=function(s,f){if(typeof s=="function"&&(f=s,s=!1),!u){f&&f();return}if(s){u.destroy(s),f&&f();return}return u.close(o=>{if(f)f(o);else if(o)throw gn(o,"no callback provided for muxrpc close")}),this},i.closed=!1,i}});var _n=a((bo,En)=>{"use strict";var di=we(),hi=F();function Ee(r,e,t,n){for(let u in e){let i=e[u],s=t?t.concat(u):[u];if(i&&typeof i=="object"){let f=i;r[u]=Ee({},f,s,n)}else{let f=i;r[u]=(...o)=>n(f,s,o)}}return r}function vi(r){if(r)throw di(r,"callback not provided")}function yi(r,e,t,n){r=r||{};function u(i,s,f){let o=typeof f[f.length-1]=="function"?f.pop():i==="sync"||i==="async"?null:vi;if(typeof o=="function"){let l;try{l=t(i,s,f,o)}catch(c){return hi.errorAsStreamOrCb(i,c,o)}return l}else return new Promise((l,c)=>{t(i,s,f,(p,d)=>{p?c(p):l(d)})})}return n?u("async","manifest",[function(i,s){if(i)return n(i);Ee(r,s,null,u),n(null,s,r)}]):Ee(r,e,null,u),r}En.exports=yi});var Pn=a((es,Sn)=>{"use strict";var re=F();function kn(r){return Array.isArray(r)?r:r.split(".")}function qi(r){return r&&typeof r.pre=="function"&&typeof r.test=="function"&&typeof r.post=="function"}Sn.exports=function(e){if(qi(e))return e;if(typeof e=="function")return{pre:e};let t=null,n={};function u(i){if(i.allow){t={};for(let s of i.allow)re.set(t,kn(s),!0)}else t=null;if(i.deny)for(let s of i.deny)re.set(n,kn(s),!0);else n={};return this}return e&&u(e),u.pre=i=>{if(i=Array.isArray(i)?i:[i],t&&!re.prefix(t,i))return new Error(`method:${i} is not in list of allowed methods`);if(n&&re.prefix(n,i))return new Error(`method:${i} is on list of disallowed methods`)},u.post=()=>{},u.test=i=>u.pre(i),u.get=()=>({allow:t,deny:n}),u}});var Bn=a((rs,On)=>{"use strict";var xi=Pn(),_e=F();On.exports=function(e,t,n){n=xi(n);function u(s,f){return s===_e.get(t,f)}function i(s,f,o){if(f==="emit")throw new Error("emit has been removed");if(s==="async"&&u("sync",f)){let l=o.pop(),c;try{c=_e.get(e,f).apply(this,o)}catch(p){return l(p)}return l(null,c)}if(!u(s,f))throw new Error(`no ${s}:${f}`);return _e.get(e,f).apply(this,o)}return function(f,o,l){let c=n.pre(o,l);if(c)throw c;return i.call(this,f,o,l)}}});var Cn=a((ts,An)=>{"use strict";var gi=br(),wi=require("events").EventEmitter,mi=mn(),Ei=_n(),_i=Bn();function Tn(r,e,t,n,u,i,s){let f;typeof r=="function"&&(f=r,r={}),e=e||{},r=r||{};let o=new wi;i||(i=gi);let l,c={_emit(d,h){return o&&o._emit(d,h),c},id:n},p=mi(_i(t,e,u).bind(c),i,d=>{if(!o.closed&&(o.closed=!0,o.emit("closed"),l)){let h=l;l=null,h(d)}});if(Ei(o,r,(d,h,v,w)=>{if(p.closed)throw new Error("stream is closed");return p.remoteCall(d,h,v,w)},f),o._emit=o.emit,s){Object.__defineGetter__.call(o,"id",()=>c.id),Object.__defineSetter__.call(o,"id",h=>{c.id=h});let d=!0;o.createStream=h=>{if(l=h,d)return d=!1,p;throw new Error("one stream per rpc")}}else o.stream=p;return o.closed=!1,o.close=function(d,h){return p.close(d,h),this},o}An.exports=function(r,e,t){return arguments.length>3?Tn.apply(this,arguments):function(n,u,i){return Tn(r,e,n,i,u,t,!0)}}});var Ln=a((m,Rn)=>{var ns=ae(),ki=pe();function In(r){r.destroy?r.destroy():console.error("warning, stream-to-pull-stream: \nthe wrapped node-stream does not implement `destroy`, \nthis may cause resource leaks.")}function Nn(r,e,t){var n,u=!1,i;function s(){i||(i=!0,t&&t(n===!0?null:n))}function f(){u||(u=!0,l(),n?s():r(n=!0,s))}function o(c){l(),n||r(n=c,s)}function l(){e.on("finish",f),e.removeListener("close",f),e.removeListener("error",o)}e.on("close",f),e.on("finish",f),e.on("error",o),process.nextTick(function(){ki(function(c){r(null,function(p,d){if(n=n||p,p===!0)return e._isStdio?s():e.end();if(n=n||p)return In(e),s(n);if(e._isStdio)e.write(d,function(){c()});else{var h=e.write(d);h===!1?e.once("drain",c):c()}})})})}function Si(r){var e=!1,t=!1,n;function u(){var i=r.read();if(i!==null&&n){var s=n;n=null,s(null,i)}}return r.on("readable",function(){t=!0,n&&u()}).on("end",function(){e=!0,n&&n(e)}).on("error",function(i){e=i,n&&n(e)}),function(i,s){n=s,e?s(e):t&&u()}}function te(r){var e=[],t=[],n,u=!1,i;function s(){for(;(e.length||n)&&t.length;)t.shift()(e.length?null:n,e.shift());!e.length&&u&&(u=!1,r.resume())}return r.on("data",function(f){e.push(f),s(),e.length&&r.pause&&(u=!0,r.pause())}),r.on("end",function(){n=!0,s()}),r.on("close",function(){n=!0,s()}),r.on("error",function(f){n=f,s()}),function(f,o){if(!o)throw new Error("*must* provide cb");if(f){let c=function(){for(;t.length;)t.shift()(f);o(f)};var l=c;if(n)return c();r.once("close",c),In(r)}else t.push(o),s()}}var Pi=te,ne=function(r,e){return function(t){return Nn(t,r,e)}},ue=function(r){return te(r)};m=Rn.exports=function(r,e){return r.writable&&r.write?r.readable?function(t){return Nn(t,r,e),te(r)}:ne(r,e):ue(r)};m.sink=ne;m.source=ue;m.read=Pi;m.read1=te;m.read2=Si;m.duplex=function(r,e){return{source:ue(r),sink:ne(r,e)}};m.transform=function(r){return function(e){var t=ue(r);return ne(r)(e),t}}});Xn(exports,{logThrough:()=>Ci});var L=k(require("net")),Dn=k(require("http")),D=k(require("fs")),Jn=k(require("path")),ke=k(require("child_process")),Se=k(Q()),ie=k(require("util")),Oi=Cn(),_=Ln(),Un;try{Un=require(`${Jn.dirname(process.argv[0])}/node_modules/node-pty`)}catch{}var $n=JSON.parse(process.env.REMOTE_CONTAINERS_SOCKETS),Bi=Te(E({},$n.reduce((r,e)=>(r[e]="duplex",r),{})),{rpc:"async",connected:"async",ready:"async"}),Ti={exec:"async",stdin:"sink",stdout:"source",stderr:"source",exit:"async",terminate:"async",dispose:"async",ptyExec:"async",ptyIn:"sink",ptyOut:"source",ptyResize:"async",ptyExit:"async",ptyTerminate:"async",ptyDispose:"async",execToEnd:"async",setBaseEnv:"async",connect:"duplex"},O=process.env,B={},T={},Mn=0,W=Oi(Bi,Ti)({exec:(r,e)=>{let t=r.cwd,n=r.env?E(E({},O),r.env):O,u=ke.spawn(r.cmd,r.args,{cwd:t,env:n,windowsHide:!0}),i=Mn++;B[i]={process:u,exit:new Promise((s,f)=>{u.once("error",f),u.once("close",(o,l)=>{s({code:o,signal:l})})}),stdin:_.sink(u.stdin),stdout:_.source(u.stdout),stderr:_.source(u.stderr)},e(null,i)},stdin:r=>B[r].stdin,stdout:r=>B[r].stdout,stderr:r=>B[r].stderr,exit:(r,e)=>{B[r].exit.then(t=>e(null,t),e)},terminate:(r,e)=>{B[r].process.kill("SIGKILL"),e()},dispose:(r,e)=>{delete B[r],e()},ptyExec:(r,e)=>{let{cwd:t,cols:n,rows:u}=r,i=r.env?E(E({},O),r.env):O,s=Un.spawn(r.cmd,r.args||[],{cwd:t,env:i,cols:n,rows:u}),f=[],o,l=s.onData(p=>{if(o){let d=o;o=void 0,d(null,p)}else f.push(p)}),c=Mn++;T[c]={process:s,exit:new Promise(p=>{s.onExit(({exitCode:d,signal:h})=>p({code:d,signal:h}))}),in:p=>{p(null,function d(h,v){if(h!==!0){if(h)throw h;s.write(v),p(null,d)}})},out:(p,d)=>{if(p)return l.dispose(),f.length=0,d(p);if(f.length){let h=f.join("");f.length=0,d(null,h)}else o=d}},e(null,c)},ptyIn:r=>T[r].in,ptyOut:r=>T[r].out,ptyResize:(r,e,t,n)=>{T[r].process.resize(e,t),n()},ptyExit:(r,e)=>{T[r].exit.then(t=>e(null,t),e)},ptyTerminate:(r,e)=>{T[r].process.kill("SIGKILL"),e()},ptyDispose:(r,e)=>{delete T[r],e()},execToEnd:(r,e)=>{let t=r.cwd,n=r.env?E(E({},O),r.env):O,u=ke.spawn(r.cmd,r.args,{cwd:t,env:n,windowsHide:!0}),i=[];u.stdout.on("data",f=>i.push(f));let s=[];u.stderr.on("data",f=>s.push(f)),u.once("error",e),u.once("close",(f,o)=>{e(null,{stdout:Buffer.concat(i),stderr:Buffer.concat(s),code:f,signal:o})})},setBaseEnv:(r,e)=>{O=r,e()},connect:Ai});(0,Se.default)(_.source(process.stdin),W.createStream(),_.sink(process.stdout));function Ai(r){if(process.platform!=="win32"||r.startsWith("\\\\.\\pipe\\"))return _.duplex(L.connect(r));let e=new L.Socket;return(async()=>{let t=await(0,ie.promisify)(D.readFile)(r),n=t.indexOf(10),u=parseInt(t.slice(0,n).toString(),10),i=t.slice(n+1);e.connect(u,"127.0.0.1",()=>{e.write(i,s=>{s&&(console.error(s),e.destroy())})})})().catch(t=>{console.error(t),e.destroy()}),_.duplex(e)}function Ci(r){return function(t,n){r(t,function(u,i){console.error(`logThrough: ${i==null?void 0:i.toString()}`),n(u,i)})}}var Gn=$n.map(async r=>{try{if(!(await(0,ie.promisify)(D.lstat)(r)).isSocket())return;await(0,ie.promisify)(D.unlink)(r)}catch(t){if(!(t&&t.code==="ENOENT"))throw t}let e=L.createServer(t=>{t=_.duplex(t),(0,Se.default)(t,W[r](n=>{n&&console.error("Remote to local stream terminated with error:",n)}),t)});return new Promise(t=>e.listen(r,t))});if(process.env.REMOTE_CONTAINERS_IPC){let r;Gn.push(new Promise(e=>r=e)),Dn.createServer((e,t)=>{let n=[];e.on("data",u=>n.push(u)),e.on("end",()=>{W.rpc(Buffer.concat(n).toString(),(u,i)=>{u?(console.error(u),t.writeHead(500),t.end()):(t.writeHead(200),t.write(i,s=>{s&&console.error(s)}),t.end())})})}).listen(process.env.REMOTE_CONTAINERS_IPC,r)}Promise.all(Gn).then(()=>W.ready(r=>{r&&console.error(r)})).catch(r=>console.error(r));W.connected(r=>{r&&console.error(r)});0&&(module.exports={logThrough});
//# sourceMappingURL=remoteContainersServer.js.map
